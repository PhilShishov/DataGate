@model AgreementOverviewViewModel

<form id="form-agreement" method="post">
    <div class="table-wrapper-double-scroll">
        <table class="table table-bordered table-hover tbl-agreements table-view-pharus">
            <thead>
                <tr>
                    <th >
                        @SharedLocalizer["File Description"]
                    </th>
                    <th >
                        @SharedLocalizer["Contract Date"]
                    </th>
                    <th >
                        @SharedLocalizer["Activation Date"]
                    </th>
                    <th >
                        @SharedLocalizer["Expiration Date"]
                    </th>
                    <th >
                        @SharedLocalizer["File Name"]
                    </th>
                    <th >
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var agreement in Model.Agreements)
                {
                    <tr class="@agreement.FileId">
                        <td class="p-1">
                            @agreement.Description
                        </td>
                        <td class="p-1">
                            @agreement.ContractDate
                        </td>
                        <td class="p-1">
                            @agreement.ActivationDate
                        </td>
                        <td class="p-1">
                            @agreement.ExpirationDate
                        </td>
                        <td class="p-1">
                            <button class="btn-link-pharus text-left"
                                    formtarget="_blank"
                                    type="submit"
                                    asp-area=""
                                    asp-route="files"
                                    asp-route-name="@agreement.SluggedName"
                                    name="agrValue"
                                    value="@agreement.Name">
                                @Html.Encode(@System.IO.Path.GetFileNameWithoutExtension(agreement.Name))
                            </button>
                        </td>
                        <td class="p-1 text-center">
                            @*<button class="btn btn-pharus btn-sm mr-1"
                                        type="submit"
                                        asp-area=""
                                        asp-route="fees"
                                        asp-route-fileId="@agreement.FileId">
                                    @SharedLocalizer["FEES"]
                                </button>
                                |*@
                            <button type="button" class="btn btn-pharus btn-sm mx-1 btn-delete">
                                @SharedLocalizer["DELETE"]
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <input type="hidden" name="AreaName" value="@Model.AreaName" />
        <input type="hidden" name="Id" value="@Model.ContainerId" />
        <input type="hidden" name="Date" value="@Model.Date" />
    </div>
</form>

<script>
    $(function () {
        // ________________________________________________________
        //
        // Double top scroll for wide table
        $('.double-scroll').doubleScroll();
        $('.table-wrapper-double-scroll').doubleScroll({ resetOnWindowResize: true });
    });

    // ________________________________________________________
    //
    // Delete selected row from agreements table by confirming
    $('.btn-delete').on('click', function () {
        const tokenAgr = $('#form-agreement input[name=__RequestVerificationToken]').val();
        const areaName = '@Model.AreaName';
        const agrValue = $(this).closest('tr').find('button').eq(0).val();
        const fileId = $(this).closest('tr').attr('class');

        var jqXhr = $.ajax({
        type: 'GET',
        url: '/media/delete',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        headers: { 'X-CSRF-TOKEN': tokenAgr },
        data: { fileId: fileId, agrValue: agrValue, areaName: areaName }
        });

        swal({
        title: "Are you sure?",
        text: "Once deleted, you will not be able to recover this file!",
        icon: "warning",
        buttons: true,
        dangerMode: true
        }).then((isConfirm) => {
        if (!isConfirm) return;
        jqXhr
        .done(function (data) {
        if (data.fileId == 'false') {
        swal("Error deleting!", "Please try again", {
        icon: "error",
        });
        return false;
        }
        $('.tbl-agreements .' + data.fileId).remove();
        $('.tbl-distinct-agreements .' + data.fileId).remove();
        swal("Your file has been deleted!", {
        icon: "success",
        });
        })
        .fail(function (request, status, error) {
        swal(request.responseText, {
        icon: "error"
            })
        });
        });
    });
</script>